# Vinculação de bibliotecas
Os ==**arquivos executáveis portáteis (PE)** usam bibliotecas e funções externas para realizar suas operações==. Essas bibliotecas podem ser vinculadas ao executável de algumas maneiras, e o método de vinculação afeta o processo de análise.

## Os métodos incluem:

- **Vinculação estática**: ==Todo o código necessário das bibliotecas é copiado para o executável durante a compilação==. Durante a análise, é difícil diferenciar o código do executável e das bibliotecas. Esse é um método de vinculação incomum em um ambiente Windows.
- **Vinculação dinâmica**: ==As bibliotecas são importadas quando o executável é carregado==. Uma lista de bibliotecas e funções necessárias é adicionada ao cabeçalho do arquivo PE durante a compilação. 
- **Vinculação em tempo de execução**: Comumente usado em executáveis mal-intencionados, especialmente os compactados ou ofuscados. ==Na vinculação em tempo de execução, os executáveis se conectam às bibliotecas e às funções que são chamadas==. Elas não são armazenadas nos cabeçalhos dos arquivos PE. Funções do Microsoft Windows como ``GetProcAddress`` , ``LoadLibrary`` , ``LdrGetProcAddress`` e ``LdrLoadDLL`` facilitam o acesso a qualquer função em qualquer biblioteca do sistema durante o tempo de execução. Se você vir essas funções, espere que o executável use funções adicionais durante o tempo de execução.

---
# Importações e exportações
Bibliotecas e importações

As importações são funções externas usadas pelos executáveis. Elas são armazenadas em bibliotecas vinculadas dinamicamente (DLLs). As bibliotecas exportam funções que os executáveis podem importar, daí o nome. Uma das ferramentas que você pode usar para analisar as importações e exportações é o pestudio, que lista as bibliotecas vinculadas dinamicamente, as importações e as exportações nas respectivas seções. A lista de bibliotecas lhe dará uma ideia geral do que um executável é capaz de fazer, enquanto a lista de importações o ajudará a restringir suas estimativas.

Os executáveis podem importar funções com seus nomes ou ordinais. Os ordinais são números atribuídos às exportações pelas bibliotecas. Os adversários podem usar ordinais em vez de nomes como um meio de ofuscação. O Pestudio geralmente faz um excelente trabalho ao encontrar o nome real da função. Entretanto, se lhe for apresentado um número ordinal dado à biblioteca, você poderá encontrar o nome da função.

O Pestudio inclui uma lista de nomes de funções de importação comumente usadas por malware. Essas funções não são maliciosas por si só, mas são frequentemente usadas por adversários para atividades maliciosas e podem fornecer dicas sobre os recursos da amostra que está sendo analisada. Se você vir uma função desconhecida, não se preocupe - você pode pesquisar na biblioteca da Microsoft Developer Network (MSDN) para obter uma visão geral orientada ao desenvolvedor ou pesquisar no Google por "<função> malware" para obter mais informações no contexto de binários maliciosos.

---
# DLLs comuns
A lista de bibliotecas (DLL) de um executável pode dizer muito sobre seus recursos gerais. A tabela abaixo mostra algumas DLLs comuns usadas com frequência por executáveis mal-intencionados.


| DLL | Description |
| ---- | ---- |
| **Kernel32.dll** | Uma biblioteca comum que contém as principais funcionalidades, como acesso e manipulação de memória, arquivos e hardware. Essa é uma DLL muito comum tanto para software legítimo quanto para malware.<br> |
| **Advapi32.dll** | Significa Advanced Windows 32 Base API e fornece funcionalidade avançada além do Kernel32. Fornece acesso a componentes como Service Manager e Registry (reiniciar/desligar o sistema, iniciar/interromper/criar serviços do Windows, gerenciar contas de usuário etc.). |
| **User32.dll** | Contém componentes para a interface gráfica do usuário, como botões, barras de rolagem, componentes para controlar/responder às ações do usuário etc. Essa DLL pode indicar a existência de uma GUI. |
| **Gdi32.dll	** | Exporta funções de GDI (Graphics Device Interface) usadas para exibir e manipular gráficos. Essa DLL pode indicar a existência de uma GUI. |
| **Ntdll.dll** | Exporta a API nativa do Windows, que é a interface usada pelos componentes do modo de usuário dos sistemas operacionais para executar ações sem a ajuda do Win32 ou de outros subsistemas de API. O Ntdll.dll é carregado diretamente quando a tarefa precisa ser executada durante a inicialização inicial do sistema, antes que o subsistema Win32 esteja disponível. Os executáveis normais não o importam diretamente. Geralmente, ela é importada indiretamente por meio do Kernel32.dll. Se o autor estiver carregando essa DLL diretamente em um executável, você pode estimar que ele pretende usar suas funcionalidades de forma anormal, por exemplo, para executar tarefas como ocultar funcionalidades ou manipular processos. |
| **Wsock32.dll ou Ws2_32.dll** | DLLs responsáveis pela rede. Um executável que se conecta a uma rede ou executa funções relacionadas à rede provavelmente acessará uma dessas DLLs. |
| **Wininet.dll**	 | Contém funções de rede de nível superior que implementam protocolos como FTP, HTTP e NTP. |

Observe que o malware pode carregar bibliotecas adicionais durante o tempo de execução com a ajuda de LoadLibrary e GetProcAddress . Ele pode carregar bibliotecas com a chamada da API LoadLibrary, encontrar o endereço de uma função específica e importá-la. Essas funções não estarão disponíveis na seção de bibliotecas e funções do pestudio.


