---
tags:
  - MALWARE-ANALISYS
  - Rangeforce
---


![alt text](https://cdn.rangeforce.com/modules/PUdIUOa3dlntN6Got/yyYBEEiDgXBWN3nLa.png "stages")

Por uma questão de tempo, um analista de malware geralmente executa os estágios mais *diretos e rápidos* da análise de malware para ter uma ideia do que está enfrentando. Em seguida, se parecer que há motivos suficientes para se aprofundar, o analista usará as técnicas mais demoradas para obter uma melhor compreensão da amostra de malware.

Indo do menos complexo para o mais complexo, os quatro estágios são:

1. **Análise totalmente automatizada**
2. **Análise de propriedades estáticas**
3. **Análise de comportamento interativo**
4. **Reversão manual de código**

A vantagem de passar primeiro pelos estágios iniciais é que o analista entenderá rapidamente alguns dos recursos do malware. Essa compreensão pode impulsionar os esforços para conter rapidamente uma infecção por malware e também facilita os estágios posteriores, pois dá ao analista uma ideia do que ele está procurando.

Embora os estágios sejam apresentados em ordem sequencial, eles não precisam ser seguidos à risca. Muitas vezes faz sentido voltar a um estágio anterior ou pular para um estágio posterior. 

# Análise totalmente automatizada
Uma maneira rápida e fácil de avaliar uma amostra de malware é examiná-la usando uma ferramenta de **análise automatizada de malware**. Essas ferramentas *executam o malware* em uma área restrita e registram tudo o que o malware faz. Quando a análise for concluída, a ferramenta produzirá um relatório que informa

- Quais arquivos foram acessados.
- Quais chaves de registro foram modificadas.
- Quais outros processos foram gerados pelo malware.
- Se o malware produziu algum tráfego de rede.
- E assim por diante.

Ferramentas de varredura totalmente automatizadas podem ajudar significativamente no processo de resposta a incidentes, pois podem lidar rapidamente com grandes quantidades de malware. 

Existem produtos comerciais e gratuitos de análise automatizada de malware. O mais conhecido é uma ferramenta gratuita chamada [**Cuckoo Sandbox**](https://cuckoo.readthedocs.io/en/latest/introduction/what/).

# Análise de propriedades estáticas
O segundo estágio da análise de malware é a análise das **propriedades estáticas** de uma amostra de malware. Nesse estágio, o *malware não é executado*. Em vez disso, o analista examina o **conteúdo do arquivo malicioso** e tenta encontrar informações úteis dessa forma.

Ao analisar um arquivo executável, as seguintes propriedades são de grande interesse:

- Strings incorporadas no arquivo
- Bibliotecas importadas e APIs usadas
- Assinaturas de empacotadores para identificar **[empacotadores](https://blog.malwarebytes.com/cybercrime/malware/2017/03/explained-packer-crypter-and-protector/)** comuns
- Hashes que podem ser usados para identificação
- Detalhes do cabeçalho
- Metadados, como a hora da criação

O malware pode vir empacotado em vários formatos de arquivo diferentes. Além de examinar apenas os arquivos executáveis, os indicadores de ameaças também podem ser encontrados em outros formatos de arquivo, como:

- Código **[VBA](https://en.wikipedia.org/wiki/Visual_Basic_for_Applications)** em documentos do Microsoft Office
- Tabelas de referência cruzada inválidas em PDFs
- Metadados EXIF suspeitos em imagens
- e assim por diante.

Quando um analista decide examinar uma amostra de malware, a análise de propriedades estáticas é um bom ponto de partida. É um processo relativamente rápido e pode ser suficiente para obter informações significativas sobre o software mal-intencionado. As informações encontradas podem ser suficientes para definir **[indicadores de comprometimento](https://digitalguardian.com/blog/what-are-indicators-compromise) (IOCs)** básicos, que você pode entregar ao **[SOC](https://digitalguardian.com/blog/what-security-operations-center-soc)** para ajudá-lo a detectar máquinas comprometidas.

O **[Pestudio](https://www.winitor.com/)** é uma ferramenta amplamente utilizada para analisar as propriedades estáticas dos executáveis do Windows. Há também o **[VirusTotal](https://www.virustotal.com/gui/home/upload)**, que é um serviço on-line. Quando você carrega um arquivo no VirusTotal, todos os indicadores de ameaças estáticas encontrados serão listados no relatório de análise. Há também ferramentas especializadas para formatos de arquivos específicos, como o **[oletools](https://github.com/decalage2/oletools)** para analisar arquivos OLE2, como documentos do Microsoft Office.

# Análise interativa do comportamento
O terceiro estágio da análise de malware envolve a execução do malware e o monitoramento do que ele faz. O malware é executado em um ambiente de laboratório isolado, geralmente em uma máquina virtual. Entre outras coisas, a **análise de comportamento** monitora:

- Alterações no sistema de arquivos
- Alterações no registro
- Processos gerados
- Tráfego de rede
- APIs chamadas

Ao responder a uma infecção por malware, as ações mencionadas acima pelo malware podem servir como IOCs, que você pode transferir para o SOC. O IOC pode ser, por exemplo, um **[registry mutex](https://www.sans.org/blog/looking-at-mutex-objects-for-malware-discovery-indicators-of-compromise/)**, um nome de arquivo específico ou uma solicitação de rede para um determinado endereço IP.

As ferramentas de monitoramento padrão usadas nesse estágio incluem **Process Monitor (Procmon)**, **Process Hacker** e **Regshot** na máquina infectada. Se os serviços precisarem ser falsificados, geralmente é usada uma máquina **[REMnux](https://remnux.org/)** que os acompanha. O **Wireshark** é frequentemente usado para capturar o tráfego de rede de e para a máquina infectada.

# Reversão manual de código
O estágio final da análise de malware envolve a **engenharia reversa** do código do executável mal-intencionado. Nesse estágio, você deve executar a amostra do malware e percorrer o código desmontado para entender o que ele faz. Esse processo é especialmente difícil porque você precisa contornar tudo o que o malware faz para impedir que você o compreenda: empacotamento de código, ofuscação de código, técnicas antidepuração e assim por diante.

A engenharia reversa é demorada, complexa e requer um conjunto de *habilidades especializadas*. Por esse motivo, muitas investigações de malware não se aprofundam na análise de código. Entretanto, essa é a única maneira de ter uma visão completa de um malware.

Por exemplo, se o malware armazena ou transfere dados criptografados ou tem um **[algoritmo de geração de domínio](https://en.wikipedia.org/wiki/Domain_generation_algorithm)**, a engenharia reversa é a única maneira prática de obter informações sobre isso.

Um depurador popular para depuração de executáveis do Windows é o **x64dbg**, enquanto o **IDA Pro** ou o **Ghidra** são comumente usados para descompilar o código do malware.