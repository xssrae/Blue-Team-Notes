---
tags:
  - MALWARE-ANALISYS
  - Rangeforce
---
# Visão geral
O tipo de informação que você deseja obter nesse estágio da análise é semelhante às informações que você obteria com a análise automatizada de sandbox: o que o malware está fazendo no sistema de arquivos, no registro e na rede. Você pode obter novos indicadores de comprometimento (IoCs) e tentar determinar os recursos da amostra que está analisando como antes. No entanto, nesse estágio, você pode exercer um controle mais refinado sobre o ambiente no qual está executando a amostra de malware. Isso é necessário para lidar com malware evasivo que não funciona bem em uma sandbox automatizada, por exemplo.

Outra vantagem de executar manualmente o malware é que você tem a opção de extrair informações da memória. Por exemplo, a amostra de malware pode descriptografar algumas cadeias de caracteres interessantes na memória que estão inicialmente criptografadas ou pode descompactar algum código na memória. Nesses casos, pode ser uma boa ideia extrair esses dados não criptografados.

Como você pode imaginar, esse tipo de análise interativa pode consumir muito tempo. Se a amostra de malware evasivo não for executada em seu laboratório, você terá que gastar tempo e esforço para descobrir por que ela não está sendo executada e o que precisa ser alterado para que ela seja executada. Às vezes, isso pode ser muito desafiador, pois talvez seja necessário iniciar a engenharia reversa do código e percorrê-lo com um depurador para entender o que está acontecendo.

# Dados e ferramentas
Há várias ferramentas diferentes que podem ajudá-lo a rastrear o comportamento dos processos em um sistema. As etapas a seguir fornecem uma visão geral de alguns dos dados que você pode capturar e das ferramentas que podem ajudá-lo a fazer isso.

# Sistema de arquivos e registro
Ao investigar os eventos relacionados ao sistema de arquivos, você está tentando principalmente ver quais arquivos são criados ou modificados pela amostra de malware. Por exemplo, o processo mal-intencionado pode estar salvando capturas de tela, um registro de pressionamentos de teclas ou uma cópia de si mesmo em algum lugar do sistema.

O [**Windows Registry**](https://en.wikipedia.org/wiki/Windows_Registry) é comumente usado por operadores de malware para **persistência**, ou seja, para ajudar a manter o acesso a um sistema quando ele é reinicializado. No entanto, na verdade, dados para praticamente qualquer finalidade podem ser armazenados no registro.

As seguintes ferramentas podem ajudar:
- **[Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon)** pode ajudá-lo a rastrear a maior parte do que um processo faz em um sistema. O Process Monitor pode ajudá-lo a rastrear a atividade no sistema de arquivos, no registro e na rede. Você também pode usar o Process Monitor para verificar se o processo mal-intencionado está gerando novos processos.
- **[Autoruns](https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns)** pode lhe dar uma visão geral dos programas que são iniciados automaticamente quando o sistema é inicializado. O Autoruns também permite que você salve essas informações. Por exemplo, você pode obter a saída dessa ferramenta em um sistema limpo, executar o malware, executar o Autoruns novamente e procurar por alterações. Se o malware configurar alguma persistência, você poderá identificá-la facilmente aqui na maioria das vezes.
- **[Capture BAT](https://www.honeynet.org/projects/old/capture-bat/)** pode ser usado de forma semelhante ao Process Monitor. Ele registrará as atividades dos processos enquanto tenta filtrar os ruídos. Se o processo mal-intencionado excluir algum arquivo, o Capture BAT também interceptará esses arquivos. Por exemplo, se a amostra de malware gravar um arquivo no disco e depois excluí-lo, o Capture BAT salvará uma cópia dele.
- **[Regshot](https://sourceforge.net/projects/regshot/)** tirará um instantâneo do registro. Você pode executar o Regshot antes e depois de iniciar o malware e comparar os resultados para ver se alguma alteração interessante foi feita pela amostra de malware.

# Atividade de rede
Em geral, sua primeira opção é não fornecer acesso total à Internet a um processo mal-intencionado. Quando quiser rastrear a atividade da rede, sua melhor aposta é configurar uma máquina separada para desempenhar o papel de servidor. Com esse método, você tem controle total sobre quais dados são enviados de volta à amostra de malware que está investigando.

Na rede, talvez seja possível capturar os endereços dos servidores de comando e controle (C2) e ver qual protocolo o malware usa para se comunicar. Você também poderá ver facilmente que tipo de informação o processo mal-intencionado está enviando de volta se o tráfego não estiver criptografado.

Mais duas ferramentas que são úteis nesse estágio:

- **[INetSim](https://www.inetsim.org/)** pode ajudá-lo a simular uma conexão com a Internet para a amostra de malware. Para malwares mais simples, você também pode executar um servidor da Web comum. No entanto, o INetSim oferece uma maneira conveniente de configurar vários serviços diferentes, além do HTTP, como FTP, SMTP e DNS, entre outros.
- O **[Wireshark](https://www.wireshark.org/)** o ajudará a capturar e analisar qualquer tráfego de rede gerado.