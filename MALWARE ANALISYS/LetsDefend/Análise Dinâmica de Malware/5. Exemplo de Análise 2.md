---
tags:
  - MALWARE-ANALISYS
  - LetsDefend
---
# Análise Dinâmica de Malware Exemplo 2

**Nome do arquivo:** Folha de pedidos de vendas.pdf.exe

**MD5 Hash:** 411019bb582ef6e3dab080d99925b4b

**SHA256 Hash:** f381e338212079c3a03fbbb532cdec44b1d27db03e8cc4c47408ef038885d934

## **Preparação**

Como nossas ferramentas de monitoramento listam todas as atividades que foram feitas desde o momento em que o malware foi executado, devemos executar essas ferramentas antes de executar o programa suspeito que temos. Caso contrário, não poderemos ver atividades maliciosas nessas ferramentas, mesmo que elas realizem atividades de software malicioso.

Vamos executar nossa ferramenta chamada 'Process Hacker' para ver as atividades do processo. Como executaremos o malware clicando na área de trabalho, veremos o processo pertencente ao malware no processo do explorer.exe, portanto, precisamos prestar atenção especial a ele.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-72.png)

Para ver as atividades do arquivo, execute a ferramenta chamada “Procmon” no kit de ferramentas SysInternals. Esta ferramenta permite-nos ver as atividades de processo, arquivo, registo e rede. No entanto, como existem tantos registros, pode ser difícil ler e concluir resultados significativos. (Sim, mesmo que você não veja, seu sistema operacional realmente funciona muito em segundo plano!)

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-73.png)

Execute o RegShot para ver as atividades do registro. Tire uma foto pressionando o botão “1st shot” antes de executar o malware. Este processo levará algum tempo.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-74.png)

Abra o aplicativo Wireshark para ver as atividades da rede.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-75-1024x379.png)

  

## **Analisar**

Agora que concluímos os preparativos necessários antes de executar o malware, você pode executar o malware em sua VM.

Para uma melhor compreensão, examinaremos as atividades de processo, rede, registro e arquivo separadamente. Depois de analisar essas atividades, criaremos uma linha do tempo.

Depois de dar tempo suficiente para o malware realizar sua atividade, vamos tirar o segundo tiro pressionando o botão "2nd shot" da ferramenta Regshot.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-76.png)

### **Atividades de processo**

Quando examinamos os processos em execução usando o Process Hacker, vemos que apenas um processo pertencente ao malware está sendo executado.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-77.png)

Como em nosso exemplo anterior, o malware pode ter criado um processo diferente, mas podemos não ser capazes de vê-lo porque ele não está sendo executado instantaneamente. Vamos confirmar esse comportamento usando a ferramenta procmon.

Se você pressionar o botão "Show Process Tree" no menu superior, o procmon mostrará a árvore de processo que ela criou para você durante o tempo em que gravou.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-78.png)

Como podemos ver na imagem acima, vemos que o primeiro processo que executamos (8780 PID) tem um processo infantil (7100 PID) chamado "regsvcs.exe".

Regsvcs.exe é uma ferramenta chamada .NET Service Installation Utility, que é instalada por padrão nos sistemas operacionais Windows pela Microsoft.

Os atacantes geralmente nomeiam aplicativos que vêm por padrão no sistema operacional para evitar a detecção. Temos que determinar se o malware que estamos examinando é realmente o aplicativo legítimo que vem por padrão no Windows ou é como o invasor nomeou seu próprio software para impedir a detecção.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-79.png)

Quando examinamos as informações de caminho do processo, vemos que o diretório real onde a ferramenta RegSvcs.exe, que vem por padrão no sistema operacional Windows aparece. Mas ainda precisamos fazer um cheque de hash para verificar isso.

Vamos obter o hash de "C:? Windows-Microsoft.NET-Framework?v4.0.30319-RegSvcs.exe" com a ajuda da ferramenta chamada HashMyFile.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-80.png)

Quando pesquisamos o hash no VirusTotal, vemos as informações que declaram que o aplicativo relevante foi publicado pela Microsoft.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-81.png)

Nós determinamos que o aplicativo em execução é realmente um aplicativo publicado pela Microsoft. Então, isso significa que o app é seguro?

Os atacantes podem injetar código malicioso em aplicativos legítimos usando técnicas como Injeção de Código, Process Hollowing, Injeção Refletora de DLL que permitem que esses aplicativos executem os códigos maliciosos. Além disso, existem binários que são chamados de "viva do binário terrestre" e que permitem que atividades maliciosas sejam realizadas sem injetar código malicioso.

Podemos supor que nosso malware cria esse processo para realizar uma atividade maliciosa, pois é criado por malware. No entanto, devemos sempre apoiar nossas suposições com evidências válidas. Da próxima vez que examinarmos as atividades de rede e registro, provaremos que esse processo é realmente usado para fins maliciosos.

Detectamos processos de malware (8780, 7100 PIDs) com a ajuda do Procmon. Em seguida, precisamos detectar a rede, o arquivo e as atividades de registro desses processos.

Você pode filtrar processos para baixo com valores de PID de 8780, 7100 no Procmon. No entanto, existe um método mais fácil. Quando você clicar com o botão direito do mouse sobre o processo de pai superior do malware e pressionar o botão " **Adicionar processo e crianças para Incluir** filtro", o procmon criará esses filtros para você.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-82.png)

### **Atividades em rede**

Antes de realizar nossa análise no Wireshark, vamos verificar se o malware faz alguma solicitação da web, pois pode ser examinado com mais facilidade.

Quando olhamos para o aplicativo Fiddler, vemos que há uma solicitação da Web feita pelo malware (regsvcs.exe, 7100 PID).

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-83.png)

Quando examinamos a solicitação da web, vemos que o malware faz uma solicitação para checkip.dyndns.org, a fim de encontrar o endereço IP público. Os invasores geralmente usam os serviços de aprendizado de endereço IP para realizar ataques direcionados ou aprender o endereço IP da vítima. Esse comportamento pode ser considerado comum para malware.

Você notou o nome do processo que faz o pedido da web? "Regsvcs.exe" não deve lançar tal pedido em uso normal.

Quando examinamos as atividades da rede sobre o Wireshark, vemos que há tráfego SMTP. SMTP é o protocolo usado para enviar e-mail. Como não enviamos e-mails, podemos dizer que este é um tráfego muito suspeito.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-84.png)

Você pode ver claramente todo o tráfego SMTP clicando com o botão direito do mouse em qualquer pacote SMTP e clicando em **“Seguir”** e depois **“Cumórum de transmissão** ”.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-85.png)

Se examinarmos o tráfego SMTP, descobrimos que o malware se conecta a skychine[.]com[.]my's mail server e envia e-mails para graceunlimited153 ?gmail[.]com com **"Pc Name: admin | Snake Keylogger** ".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-86.png)

Quando olhamos para o conteúdo do e-mail, vemos que existem vários anexos com nomes como "Password.txt", "User.txt". Para levar o conteúdo para o formato legível, temos que base64 decodificação.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-87.png)

Como você pode ver no título do assunto e do conteúdo de e-mail, o malware que analisamos é realmente o Snake Keylogger.

Quando olhamos para o conteúdo de e-mail, podemos ver que o malware envia o nome de usuário, informações de senha dos aplicativos da web e o endereço IP do dispositivo.

Os atacantes geralmente enviam as informações que obtiveram para seus próprios endereços de e-mail usando servidores SMTP que eles apreenderam anteriormente. Em outras palavras, o skychine[.]com[.] meu nome de domínio é na verdade um servidor SMTP que não é malicioso, mas é sequestrado pelo invasor e usado para fins maliciosos. No entanto, uma vez que o e-mail enviado foi enviado para o endereço de e-mail do atacante, o endereço Graceunlimited153-gmail.com provavelmente pertence ao invasor.

  

## **Resultado**
Agora que concluímos a análise de malware, podemos combinar as informações que reunimos. Nós detectamos que:

- É o Snake Keylogger
- Roubar credenciais de navegadores
- Verifica o endereço IP
- Exfiltra os dados via SMTP
- Conecta skyshine.com[.]my:25