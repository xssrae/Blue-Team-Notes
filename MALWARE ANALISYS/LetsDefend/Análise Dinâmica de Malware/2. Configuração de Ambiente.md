---
tags:
  - MALWARE-ANALISYS
  - LetsDefend
---
# Ferramentas e Softwares
Vamos precisar de algum software ao aplicar o método de análise dinâmica. Vamos dar uma olhada nessas categorias de software.

## **Software de virtualização**
Não queremos realizar análises dinâmicas em nosso próprio sistema, pois precisamos executar o malware para poder examinar suas atividades. Por esta razão, devemos fazer uso de software de virtualização que nos ajuda a trabalhar em alguns sistemas virtuais.

Alguns dos softwares de virtualização usados são os seguintes:

- VMware Workstation
- VMware Fusion
- Oracle Virtualbox
## **Softwares de Utilidade**
Depois de instalar seu próprio sistema operacional virtual, você precisa instalar um software que será útil na análise dinâmica. 

1. Microsoft Office
2. Adobe Reader
3. Browser (Chrome, Firefox etc.)
4. WinRAR
5. Notepad++, Sublime Text etc.

Os atacantes estão muito familiarizados com o método de análise dinâmica. Portanto, eles verificam se o software usado com frequência é instalado ou não no sistema de destino para determinar se o malware está sendo executado em um sistema operacional virtual antes de realizar atividades maliciosas nos dispositivos que eles comprometeram.
## **Depuradors**
Depuradores são softwares que geralmente são usados por programadores para testar os códigos e detectar os erros. Depuradores ajudam a ver as instruções de um processo e alteram o fluxo do programa

Os analistas de malware frequentemente usam depurantes para aprender a estrutura de trabalho do malware e desativar alguns mecanismos de prevenção, fazendo alterações nos códigos de malware.

Alguns depurantes que são frequentemente preferidos por analistas de malware são os seguintes.

- Ollydbg
- X64dbg
- Windbg
- Radare2
## **Ferramentas de monitoramento de rede**
Informações como as conexões de rede estabelecidas pelo malware, os endereços com os mesmos e como ele se comunica com eles devem ser relatadas como resultado da análise de malware.

Alguns deles são os seguintes.

- Wireshark
- Fiddler
- Burp Suite
## **Ferramentas de Monitoramento de Processos**
Um novo processo é criado para o programa que executamos para análise de malware. Para monitorar esses processos, devemos usar ferramentas de monitoramento de processos.

O Windows já vem com uma ferramenta de monitoramento de processos chamada “Task Manager”. No entanto, outras ferramentas de monitoramento de processos são mais úteis em termos de uso e recursos para análise de malware.

- Process Hacker
- Process Explorer (SysInternals)
- Procmon (SysInternals)
## **Ferramentas de Monitoramento de Atividade de Arquivo**
As atividades de arquivo são uma das primeiras atividades que devem ser seguidas em análise dinâmica. O malware pode ler arquivos para coletar informações do sistema operacional, escrever outros componentes do malware para o sistema de arquivos e mover-se para a pasta de inicialização para garantir a persistência. O malware pode estar envolvido em várias atividades no sistema de arquivos por esses e outros motivos. Devemos detectar e indicar essas atividades no relatório de análise de malware.

Você pode usar as seguintes ferramentas para ver as atividades do arquivo.

- Sysmon
- SysInternal Tools
- CFF Explorer
- PEView
- TriDNet
- BinText
- PEiD
- Regshot
- HashMyFiles

---
# Criação de Máquina Virtual
## **Instalando o sistema operacional**

Depois de instalar o software de virtualização em nosso sistema, vamos configurar nosso sistema operacional com a ajuda desses softwares de virtualização.

Para instalar o sistema operacional juntamente com o software de virtualização, precisamos obter os arquivos ISO dos sistemas operacionais. Você pode usar o aplicativo chamado [MediaCreationTool](https://www.microsoft.com/en-us/software-download/windows10) publicado pela Microsoft para criar um arquivo ISO para o sistema operacional Windows.

Quando você executa o MediaCreationTool, você será solicitado com as opções “Atualize este PC agora” e “Criar mídia de instalação”. Vamos continuar selecionando a opção "Criar mídia de instalação".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-22.png)

Em seguida, somos solicitados a escolher Idioma, informações de versão do sistema operacional e arquitetura do sistema operacional. A partir daqui, você pode escolher a opção Windows 10 64bit. Recomendamos que você escolha o sistema operacional com arquitetura de 64 bits primeiro. Você pode executar aplicativos de 32 bits e aplicativos de 64 bits em sistemas operacionais com arquitetura de 64 bits, mas você só pode executar aplicativos de 32 bits em sistemas operacionais com arquitetura de 32 bits.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-23.png)

Depois de escolher as informações e a arquitetura da versão do sistema operacional, somos perguntados se queremos escrever na unidade USB ou criar um arquivo ISO. Como precisamos do arquivo ISO, escolhemos a opção ISO aqui.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-24.png)

Então somos questionados em qual diretório queremos que o arquivo ISO seja salvo. Você pode escolher um diretório apropriado para você.

Quando você concluir essas etapas, o arquivo ISO será salvo no diretório que você especificou. (Este passo pode demorar muito tempo.)

Agora que temos o arquivo ISO, podemos proceder à instalação do sistema operacional. Como a VMware Workstation será usada nesta série de treinamentos, a palestra será por meio deste software. No entanto, se você deseja usar outro software de virtualização, você deve ser capaz de adaptar a palestra para outros softwares de virtualização facilmente, uma vez que todos esses softwares são muito semelhantes.

Como vamos instalar um novo sistema operacional, devemos primeiro clicar no botão "Criar uma nova máquina virtual". Alternativamente, você pode selecionar “Arquivo” no menu superior e depois em “Nova Máquina Virtual”.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-25.png)

Então, somos solicitados a escolher com que tipo de instalação queremos proceder. Continuamos a nossa instalação escolhendo “Típica (recomendada)”.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-26.png)

Selecionamos o arquivo ISO que baixamos selecionando a opção “Installer Disc image file (iso)”.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-27.png)

Em seguida, somos solicitados a nomear a Máquina Virtual e especificar o diretório que queremos que os arquivos da VM sejam mantidos. Você pode usar "Windows10 Dynamic Analysis" como o nome e "o diretório padrão" como o diretório. Recomendamos dar-lhe um nome descritivo para a sua VM para que você não confunda suas VMs se tiver várias. Se desejar, você pode alterar esse nome que você deu à VM mais tarde.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-28.png)

Depois de escolher o nome e o diretório onde os arquivos da VM serão mantidos, somos solicitados a determinar o tamanho do disco do nosso sistema operacional. Como instalaremos vários softwares e aplicativos nele, recomendamos que você aloque um mínimo de 60 a 70 GB.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-29.png)

Finalmente, somos apresentados a algumas configurações de hardware que o sistema operacional usa. Nesta fase, vamos para a etapa de personalização clicando no botão "Personalizar hardware".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-30.png)

Como estamos usando um sistema operacional com uma arquitetura de 64 bits, recomendo reservar um mínimo de 4 GB de RAM. Se você atribuir configurações mais baixas, poderá acabar com erros de desempenho e sistema operacional. No entanto, se você estiver instalando um sistema operacional com uma arquitetura de 32 bits, poderá alocar menos RAM.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-31.png)

Depois de passarmos por esse estágio, uma Máquina Virtual com as configurações especificadas está sendo criada.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-32.png)

Depois que a VM é criada, você pode instalar o sistema operacional normalmente executando a VM criada.

## **Instalação de ferramentas e softwares**

Neste ponto, nosso sistema operacional está pronto para uso. Em seguida, a instalação de ferramentas e softwares que usaremos durante a análise dinâmica.

Você deve instalar as ferramentas que mencionamos em nosso artigo anterior no seu sistema operacional virtual agora. Você pode facilmente instalar essas ferramentas seguindo o assistente de configuração.

## **Ajustando a máquina virtual**

Precisamos fazer algumas alterações de configuração em nossa Máquina Virtual para poder usá-la para análise de malware.

1. **Desligar soluções anti-malware**

Como analisaremos o malware em nossa VM, não queremos que o software antivírus exclua o malware que instalamos para análise. Devemos desativar o Windows Defender, que vem ativo por padrão nos sistemas operacionais Windows.

Você deve ir para as configurações do Windows Defender e desativar todas as configurações ativas. O recurso que verifica e exclui instantaneamente o malware que você instalou para analisar é **“proteção em tempo** real”. Certifique-se de desativar esse recurso.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-33.png)

**Desativar o Windows Defender Usando a Política de Grupo**

Você pode abrir o aplicativo Editor de Políticas de Grupo Local pesquisando “edit group policy” no menu Iniciar. Alternativamente, você pode acessar o aplicativo Editor de Políticas de Grupo Local pesquisando por “gpedit.msc” ou executando-o através da função “Busca-Run” no Windows.

Para desabilitar o Windows Defender usando o aplicativo Editor de Políticas de Grupo Local, você deve acessar a política abaixo.

*“Configuração de Computadores ? Templates Administrativos ? Componentes do Windows ? Microsoft Defender Antivirus”*

Aqui, você deve clicar duas vezes na política "Desativar o Microsoft Defender Antivirus" e defina-a como "Ativado".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-34.png)

Você também deve desativar a política "Monitorar arquivo e atividade do programa no seu computador" em "Proteção em tempo real".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-35.png)

2. **Renomear seu sistema operacional virtual**

Alguns softwares maliciosos fazem várias verificações para não funcionar em ambientes de análise. Uma dessas verificações é verificar o nome do host. Como a maioria das sandboxes tem nomes de host como "Sandbox", "Malware", "Cuckoo" ..., o malware é programado para não ser executado em sistemas com esses nomes de host.

Você deve fazer com que sua VM pareça um sistema de usuário normal, tanto quanto possível, para que você possa evitar técnicas anti-análise. Especificar um nome aleatório como o nome do host permitirá que você ajude a evitar tais verificações.

Para alterar o nome do dispositivo, você deve selecionar “Configurações ? Sistema ? Sobre” e, em seguida, clique no botão “Renomear este PC”.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-36.png)

Não se esqueça de mudar seu nome de usuário também!

3. **Desative as atualizações automáticas**

O malware que vamos analisar pode estar tirando proveito de vulnerabilidades no sistema operacional. Para que o malware seja executado o mais normalmente possível, precisamos desativar as atualizações automáticas do nosso sistema operacional virtual.

Você pode desativar as atualizações automáticas através das configurações de política de grupo.

Você pode abrir o aplicativo Editor de Políticas de Grupo Local pesquisando “edit group policy” no menu Iniciar. Alternativamente, você pode acessar o aplicativo Editor de Políticas de Grupo Local pesquisando por “gpedit.msc” ou executando-o através da função “Pesquisar” no Windows.

Você deve acessar a política abaixo.

*“Configuração de computador ? Templates administrativos ? Componentes do Windows ? Windows Update”*

Depois de acessar a política relevante, você deve definir a política chamada "Configurar atualizações automáticas" para "Desabilitado".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-37-1024x435.png)

4. **Desativar extensões ocultas**

Você pode ter visto os atacantes tentar enganar suas vítimas alterando as extensões de arquivo. Como é que eles puderam fazer isto?

Os sistemas operacionais Windows estão configurados para ocultar extensões de arquivo conhecidas por padrão. Em outras palavras, um arquivo chamado "Chrome.exe" aparecerá como "Chrome" por padrão. Os atacantes nomeiam seu software malicioso como "Photo.jpg.exe", fazendo com que o usuário veja o arquivo como "Photo.jpg". Quando o usuário pensa que este arquivo é um arquivo de imagem e abre, o malware começará a ser executado.

Para não confundir isso durante nossa análise, precisamos corrigi-lo para que as extensões que estão ocultas por padrão sejam sempre mostradas.

Para isso, precisamos abrir o aplicativo chamado “File Explorer” e acessar o menu de configurações clicando nos botões “Arquivo” e depois em “Alterar as opções de pasta e pesquisa” no menu superior.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-38.png)

Em seguida, você deve salvar as configurações desmarcando "Ocultar extensões para tipos de arquivos conhecidos" na guia "Visualizar".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-39.png)

5. **Mostrar arquivos e pastas escondidas**

O malware visa impedir que o usuário detecte seus arquivos, escondendo-os. Por padrão, mostrar arquivos e diretórios ocultos nos permitirá realizar uma análise mais confortável.

Vamos abrir o aplicativo chamado File Explorer e abrir o menu de configurações com a ajuda de "Arquivo" no menu superior e clique em "Alterar pasta e opções de pesquisa".

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-40.png)

Em seguida, vamos verificar o "Mostrar arquivos ocultos, pastas e unidades" na guia "Visualizar" e salvar a configuração.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-41.png)

6. **Desativar o ASLR**

Novas versões do Windows têm um mecanismo de segurança anti-exploição chamado ASLR (Address Space Layout Randomization). Não entraremos muito no ASLR neste treinamento, mas você pode querer desativar esse recurso nesta fase, pois ele aparecerá no futuro.

Você pode desativar essa configuração com a ajuda do Registro. Acesse o seguinte registro ao abrir o aplicativo do Editor do Registro.

“HKEY_LOCAL_MACHINE-SYSTEM-CurrentControlSet-Control-Control-Controlo-Gestão da Memória””

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-42.png)

Em seguida, crie uma chave do tipo “REG_DWORD” chamada “MoveImages”.

Essas configurações acabarão por desativar o recurso ASLR.

7. **Desativar o Firewall do Windows**

Conforme implementamos nas etapas anteriores, devemos desativar o Firewall do Windows para evitar que os mecanismos de segurança interfira com o software malicioso que analisamos.

Acesse as configurações do Firewall do Windows Defender através do painel de controle. Você pode acessar essas configurações usando a barra de pesquisa no menu superior do Explorador de Arquivos. Se você copiar e pesquisar o caminho a seguir nesta barra de pesquisa, ele irá levá-lo para as configurações do Firewall do Windows Defender.

“Control Panele e Security” Windows Defender Firewall – Personalizar Configurações”

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-43.png)

Depois de acessar as configurações do Firewall do Defender, selecione "Desligar o Firewall do Windows Defender" e salvá-lo. Isso irá desabilitar o firewall.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-44.png)

8. **Mimic an End-User System (tradeira)**

Você deve fazer com que sua VM pareça um sistema operacional normal do usuário final, tanto quanto possível, para que o malware que você está analisando não seja capturado por técnicas anti-análise.

Como não há instruções ou configurações precisas para isso, depende totalmente de você fazer sua VM de análise parecer um computador de usuário final normal. Podemos recomendar as seguintes dicas para implementar em sua VM para estabelecer essa similaridade:

- Instalar navegadores frequentemente preferidos por usuários finais, como Chrome e Firefox,
- Deixar arquivos em diferentes diretórios que serão de interesse para o atacante,
- Alterar o fundo da área de trabalho,
- Para garantir que alguns arquivos sejam encontrados no diretório Downloads baixando pequenos aplicativos através do navegador

9. **Alterar configurações de rede**

Precisamos evitar que nosso malware se espalhe para diferentes dispositivos via conexão de rede. Graças às redes privadas fornecidas pelo software de virtualização, podemos impedir que o malware infecte diferentes dispositivos.

Para isso, você deve clicar no menu "VM" no menu superior da VMware Workstation e selecionar "Configurações".

Você deve selecionar a configuração "Persond" selecionando "Adaptador de rede" no menu à esquerda na janela que se abre.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-45.png)

  

# Snapshot

Seu sistema operacional pode ser afetado funcionalmente ou tornar-se inutilizável depois de analisar malware ou ransomware em seu sistema. Quando você deseja analisar um novo malware depois de executar e analisar outro malware, você não quer que seu sistema operacional seja afetado pelas alterações feitas pelo malware antigo que você analisou.

Nesses casos, você pode aproveitar o recurso Instantâneo do software de virtualização.

O Snapshot é um recurso que permite tirar uma foto da sua Máquina Virtual e retornar a esse backup mais tarde.

Nossa VM foi configurada para análise de malware e os aplicativos que usaremos na análise foram instalados nele. Nesta fase, você pode pegar um Instantâneo e, em seguida, mudar para o mesmo ambiente de análise com sua VM limpa.

Para tirar fotos, você pode acessar a tela onde gerencia os instantâneos clicando no menu "VM" no menu superior do aplicativo VMware Workstation e clicando em "Snapshot" - "Gerenciador de snapshot".

Em seguida, você pode tirar uma foto da sua VM clicando no botão "Pegar o Instantâneo". Isso é como é fácil tirar fotos.

![](https://letsdefend.io/blog/wp-content/uploads/2022/07/image-46.png)

Inserir informações detalhadas sobre a descrição permitirá que você encontre facilmente o instantâneo que você precisa. Por esta razão, recomendamos que você insira o mais descritivo possível.